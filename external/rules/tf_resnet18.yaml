# Rules to import pytorch ResNet18 pretrained model into checkpoints.
#
# Model:
#     https://github.com/pytorch/vision/blob/master/torchvision/models/resnet.py
# Weights:
#     https://download.pytorch.org/models/resnet18-5c106cde.pth
#
# Tensors require us to permute them, as their spatial ordering is different
# from tensorflow.
#
# Convolution:
#     torch:      [out_maps, in_maps, kernel_h, kernel_w]
#     tensorflow: [kernel_h, kernel_w, in_maps, out_maps]
---
permute:
    2: [{type: transpose, axes: [1, 0]}]
    4: [{type: transpose, axes: [2, 3, 1, 0]}]
rename:
    / : \.
    resnet18: module
    biases: bias
    weights: weight
    weights.DynamicNetworkSurgeryPruner.mask: mask
    conv(\d).BatchNorm: bn\1
    moving_mean: running_mean
    moving_var: running_var
    gamma: weight
    beta: bias
    resnet18/fc5: fc
    b(\d)1: layer\1.0
    b(\d)2: layer\1.1
    downsample_shortcut: downsample.0
    downsample_shortcut.BatchNorm: downsample.1
