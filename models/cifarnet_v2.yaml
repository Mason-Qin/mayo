---
dataset:
    background_class: {use: false}
    preprocess:
        shape:
            height: 32
            width: 32
            channels: 3
        validate:
            - {type: crop_or_pad}
            # - {type: central_crop, fraction: 0.875}
        final_cpu:
            - {type: standardize_image}
model:
    name: cifarnet_v2
    description: |
        A network model for CIFAR-10 training. Aiming for 90%+ accuracy.
        References::
          https://github.com/MateLabs/All-Conv-Keras/blob/master/allconv.py
          https://arxiv.org/pdf/1412.6806.pdf
    layers:
        _conv: &conv
            type: convolution
            padding: same
            kernel_size: 3
            weights_initializer: &trunc_norm_init
                type: tensorflow.truncated_normal_initializer
                stddev: 0.05
            normalizer_fn:
                type: tensorflow.contrib.slim.batch_norm
                center: true
                scale: true
                decay: 0.9997
                epsilon: 0.001
        _pool: &pool
            type: max_pool
            kernel_size: 3
            stride: 2
            padding: same
        _fc: &fc
            type: fully_connected
            weights_initializer:
                <<: *trunc_norm_init
                stddev: 0.04
            biases_initializer: &bias_init
                type: tensorflow.constant_initializer
                value: 0.1
            weights_regularizer:
                type: tensorflow.contrib.layers.l2_regularizer
                scale: 0.004
        dropout0: {type: dropout, keep_prob: 0.8}
        conv0: {<<: *conv, num_outputs: 96}
        conv1: {<<: *conv, num_outputs: 96}
        conv2: {<<: *conv, stride: 2, num_outputs: 96, activation_fn: null}
        dropout2: {type: dropout, keep_prob: 0.5}
        conv3: {<<: *conv, num_outputs: 192}
        conv4: {<<: *conv, num_outputs: 192}
        conv5: {<<: *conv, stride: 2, num_outputs: 192, activation_fn: null}
        dropout5: {type: dropout, keep_prob: 0.5}
        conv6: {<<: *conv, num_outputs: 192}
        conv7: {<<: *conv, kernel_size: 1, padding: valid, num_outputs: 192}
        conv8: {<<: *conv, kernel_size: 1, padding: valid, num_outputs: 10, activation_fn: null}
        logits: {type: squeeze, axis: [1, 2]}
        avgpool: {type: average_pool, kernel_size: 8, stride: 1}
    graph:
        from: input
        with: [
            conv0, conv1, conv2, dropout2,
            conv3, conv4, conv5, dropout5,
            conv6, conv7, conv8, avgpool,
            logits]
        to: output
